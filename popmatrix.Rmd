---
title: "Rabbits and Hawks"
author: "Shuhan Song"
date: "5/16/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,
                      warning = FALSE, 
                      message = FALSE)
library(tidyverse)
library(sensitivity)
```

```{r}
source("R/evolve_pop.R")
# set parameters
fert_rab = c(0,2,6,1) # fertility
surv_rab = c(0.8,0.85,0.65,0.1) #survivability
ini = c(0,0,10,0) # initial population
nyears = 20

# use the function
rab_pop=evolve_pop(fert_rab, surv_rab, ini, nyears)

rab_pop$popbyage[1,20]
```

```{r}
# sobel

# initialize two samples of parameters
nsample = 200
sample1 = cbind.data.frame(p01 = runif(n=nsample, min=0.65, max=0.75),
                           p12 = runif(n=nsample, min=0.75, max=0.8))
sample2 = cbind.data.frame(p01 = runif(n=nsample, min=0.65, max=0.75),
                           p12 = runif(n=nsample, min=0.75, max=0.8))

# get sobel samples
sens_rabsur=soboljansen(model = NULL, sample1, sample2, nboot = 100)

head(sens_rabsur$X)
nsim=nrow(sens_rabsur$X)

# constant input
## survivability
p23 = 0.65
p34 = 0.1
## fertility rate
f1 = 0.0
f2 = 2
f3 = 6
f4 = 1
## initial population
ini = c(0,0,10,0)
## nstep
nyears = 20

# create wrapper function
p_wrapper = function(p01, p12, p23=0.65, p34=0.1, f1=0,f2=2,f3=6,f4=1, use_func, initialpop, nstep ) {
fertility=c(f1,f2,f3,f4)
survivability= c(p01,p12,p23,p34)
res = use_func(survivability =survivability, fertility = fertility, initialpop=initialpop, nstep=nstep)
# now return the final population total
return(finalpop=res$poptot[nstep])
}

res = as.data.frame(sens_rabsur$X) %>% pmap_dbl(p_wrapper, initialpop=ini, nstep=nyears, use_func=evolve_pop)
```

